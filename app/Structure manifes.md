# **Структура проекта с разделением доменных моделей**

Ниже приведена рекомендация по организации кода в FastAPI-проекте с разделением доменных моделей и вспомогательных компонентов. Основная цель — четко разграничить бизнес-логику, инфраструктуру и настройку приложения.

---

## 1. Доменные модули (по моделям и функциям)

Каждый домен (модель) выделяется в отдельную папку со следующей структурой:

```
├── users/                 # Домен "Пользователи"
│   ├── router.py          # Маршруты (эндпоинты) для CRUD-операций
│   ├── schemas.py         # Pydantic-схемы для валидации и сериализации
│   ├── models.py          # ORM-модели (SQLAlchemy)
│   ├── dao.py             # Низкоуровневый доступ к данным (Data Access Object)
│   ├── dependencies.py    # Зависимости FastAPI (например, текущий пользователь)
│   └── auth.py            # Логика аутентификации/авторизации
```

**Основными в этой структуре являются**

- `router.py` — регистрирует маршруты и объединяет схемы, зависимости и обработчики.
- `schemas.py` — Pydantic-модели для входных и выходных данных.
- `models.py` — описание таблиц базы данных через SQLAlchemy `DeclarativeBase`
они предоставляют основную логику доменной модели(если я ее корректно понимаю)

**Так же часто используемыми элементами логики являются**

- `dao.py` (или `repository.py` **в паттерне Repository**) — класс(ы) для операций с БД (CRUD).
- `dependencies.py` — функции/FastAPI Depends для общих зависимостей (проверка токена, извлечение пользователя).

**Пример дополнительных модулей связанных с доменой моделью и в дальнейшем используемые в приложении**
- `auth.py` — процессы логина, хеширования паролей, выдачи JWT и т.п.

---

## 2. Файлы верхнего уровня

На уровне корня проекта обычно располагаются следующие компоненты:

```
├── database.py            # Конфигурация подключения к БД и инициализация
├── config.py              # Настройки приложения (через Pydantic BaseSettings)
├── main.py                # Создание FastAPI-инстанса и подключение маршрутов
├── exceptions.py          # Общие кастомные исключения и обработчики
```

- `database.py`
    - Составляет `DATABASE_URL` (например, из environment variables).
    - Создает `engine = create_async_engine(DATABASE_URL)`.
    - Настраивает фабрику сессий `async_sessionmaker(engine, expire_on_commit=False)`.
    - Объявляет базовый класс `class Base(AsyncAttrs, DeclarativeBase): ...` для всех моделей.
- `config.py`
    - Расширяет `pydantic.BaseSettings` для хранения URL-ов, секретов, флагов работы в разных окружениях.
- `main.py`
    - Инициализирует `**app = FastAPI()**`.
    - Импортирует и подключает все маршруты из доменных модулей.
- `exceptions.py`
    - Определяет набор `HTTPException`-унаследованных классов для разных ошибок (например, `NotFoundError`, `UnauthorizedError`).
    - Упрощает локализацию и поиск точек генерации ошибок.


---

## 3. Структура разделения фронтенда

Если проект включает отдачу статических страниц или сборку фронтенда, выделяют два каталога:

```
├─ pages/  # HTML-страницы или маршруты отдачи файлов
├─ static/ #CSS, JS, изображения, собранный фронтенд (например, Vue/React build)
```

- `pages/` — содержит шаблоны или готовые HTML-файлы, которые можно отдавать по маршрутам.
- `static/` — служит для отдачи неизменных ресурсов. Обычно на продакшене их обслуживает nginx: `location /static/ { root /path/to/project/static; }`.

---

## 4. Вспомогательные папки (инфраструктурные слои)

Вспомогательные элементы могут находиться в отдельных папках, если они перекрывают несколько доменов:

- `dao/` — общий интерфейс и базовые классы DAO/Repository.
- `utils/` — утилиты и хелперы (formatters, логгеры, валидаторы).

Так же возможны другие пока не реализованные домены

- `services/` — бизнес-логика, объединяющая несколько доменов (например, отправка почты, интеграции).
- `tasks/` — асинхронные фоновые задачи (Celery, APScheduler).

> [!WARNING] *Паттерн Repository* в данном **ПРОЕКТЕ**
>  выступает «прокачанным DAO», так как получает сессию к БД и инкапсулирует транзакции (Unit of Work) — подробнее: https://habr.com/ru/companies/otus/articles/836128/

> **Важно:** держите доменные модули «чистыми» от инфраструктуры: любые задачи, не относящиеся напрямую к бизнес-правилам, выносите во внешние сервисы или утилиты.(Это нейронка нагенерила когда я ей на формотирование отдал свой текст)

---

# Такой подход обеспечивает:

- **Четкое разделение ответственности**: каждый файл отвечает за свой уровень абстракции.
- **Легкую поддержку и масштабирование**: при росте проекта новые домены добавляются по единому шаблону.    
- **Удобную навигацию**: коллегам проще понять структуру и быстро найти нужное.

---
# Вопросы для обсуждения
Я чет не могу во всю эту концепцию воткнуть сессию которая инициализируется во время обращения к эндпоинту.
Буду рад услышать критику